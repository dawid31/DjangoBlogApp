{% include 'DjangoBlogApp/main.html' %}

{% block content %}

<div class="home-container">

    <div class="sidebar-container">
        <h3>Filter Posts</h3>
        <a href="{% url 'home' %}?q={{request.user}}">My posts</a>
    </div>

    <div class="home-middle">

        <div class="above-posts-container">
            <div class="above-posts-container-left">
                <smaller>
                    Activity Feed
                    <br>
                    {{posts.count}} post{{posts.count|pluralize}} matching searching criteria
                </smaller>
            </div>

            <div class="above-posts-container-right">
                {% if user.is_authenticated %}
                <h3><a href="{% url 'create-post' %}">+ Create Post</a></h3>
                {% endif %}

            </div>

        </div>

        <div class="posts-container">

            {% for post in posts %}
            <div class="post-container">
            
                <div class="avatar-container">
                    <img src="{{post.host.profile.avatar.url}}" class="rounded-circle" style="width: 75px; height: 75px;"/>
                </div>

                <div class="content-container">
                    <h1>{{post.name}}</h1>
                    <p><a href="{% url 'profile' post.host.id %}">@{{post.host}}</a> • {{post.published|timesince}} ago</p>
                    {{post.content|slice:":200"|linebreaks}}
                    {% if post.content|length > 200 %}
                        <a href="{% url 'post-details' post.id%}">[Read more]</a>
                    {% endif %}

                    {% if post.img %}
                    <div class="multimedia-container">
                        <img style="max-width: 400px; max-height: 266px;" src="{{post.img.url}}"/>
                    </div>
                    {% endif %}

                    <div class="comments-container">

                    {% for comment in post.comments.all %}
                        <div class="comment-container">

                            <div class="comment-user-container">
                                <img src="{{comment.author.profile.avatar.url}}" class="rounded-circle" style="width: 50px; height: 50px;"/>
                                <a href="{% url 'profile' comment.author.id %}">@{{comment.author}}</a> • {{comment.published|timesince}} ago
                            </div>

                            <div class="comment-content-container">
                                {{comment.content|linebreaks}}
                            </div>
                        </div>
                    {% endfor %}

                        <div class="like-comment-save-container">
                            <a href="{% url 'post-details' post.id%}">See whole discussion</a>
                        </div>
                        
                    </div>
                </div>

                <div class="like-edit-delete-container">
                    <a>like</a>
                    {% if request.user == post.host %}
                    <a href="{% url 'edit-post' post.id %}">edit</a>
                    <a href="{% url 'delete-post' post.id %}">delete</a>
                    {% endif %}
                </div>

            </div>
            {% endfor %}
        </div>

    </div>

    <div class="right-sidebar">

        <div class="sidebar-most-and-recent-container">

            <div class="sidebar-label">
                MOST ACTIVE USERS
            </div>
    
            <div class="sidebar-content">
                {% for user, posts in users_and_posts.items %}
                    <p>{{user.username}}: {{posts}} posts</p>
                {% endfor %}
            </div> 

        </div>

        <div class="sidebar-most-and-recent-container">
            <div class="sidebar-label">
                RECENT ACTIVITY
            </div>

            <div class="sidebar-content">
                {% for post in recent_posts %}
                    <div class="sidebar-content-element">

                        <div class="sidebar-content-element-post-info">

                            <div class="sidebar-content-element-user-avatar">
                                <img src="{{post.host.profile.avatar.url}}" class="rounded-circle" style="width: 40px; height: 40px; border: solid; border-color: green;"/>
                            </div>

                            <div class="sidebar-content-element-rest">

                                <div class="sidebar-content-element-host-info">
                                    <a href="{% url 'profile' post.host.id %}">@{{post.host}}</a>
                                </div>
        
                                <div class="sidebar-content-element-post-date">
                                    {{post.published|timesince}} ago
                                </div>
                                
                            </div>

                            
                            
                        </div>
        
                        <div class="sidebar-content-element-post-name">
                            <a href="{% url 'post-details' post.id %}">{{post.name}}</a>
                        </div>                       
                    </div>
                {% endfor %}
            </div>
        
        </div>
    
    </div>
</div>
{% endblock content %}
    


